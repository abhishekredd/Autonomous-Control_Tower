services:
  - type: web
    name: api
    env: docker
    plan: free
    dockerfilePath: docker/Dockerfile.api
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port 8000
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: REDIS_URL
        sync: false
      - key: RABBITMQ_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: SECRET_KEY
        sync: false
      - key: DEBUG
        sync: false

  - type: worker
    name: celery-worker
    env: docker
    plan: free
    dockerfilePath: docker/Dockerfile.api
    startCommand: celery -A app.core.celery_app worker --loglevel=info
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: REDIS_URL
        sync: false
      - key: RABBITMQ_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false

  - type: worker
    name: celery-beat
    env: docker
    plan: free
    dockerfilePath: docker/Dockerfile.api
    startCommand: celery -A app.core.celery_app beat --loglevel=info
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: REDIS_URL
        sync: false
      - key: RABBITMQ_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false

  - type: worker
    name: mcp-risk-detector
    env: docker
    plan: free
    dockerfilePath: docker/Dockerfile.mcp
    startCommand: python -m app.mcp.servers.risk_detector
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: REDIS_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false

  - type: worker
    name: mcp-route-optimizer
    env: docker
    plan: free
    dockerfilePath: docker/Dockerfile.mcp
    startCommand: python -m app.mcp.servers.route_optimizer
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: REDIS_URL
        sync: false

  - type: worker
    name: mcp-stakeholder-comms
    env: docker
    plan: free
    dockerfilePath: docker/Dockerfile.mcp
    startCommand: python -m app.mcp.servers.stakeholder_comms
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: REDIS_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false

  - type: web
    name: frontend
    env: docker
    plan: free
    dockerfilePath: frontend/Dockerfile
    startCommand: streamlit run app.py --server.port 8501 --server.address 0.0.0.0
    envVars:
      - key: API_URL
        value: https://api.onrender.com
